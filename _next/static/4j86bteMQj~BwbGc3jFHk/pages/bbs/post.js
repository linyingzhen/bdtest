(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{1067:function(t,e,n){"use strict";n.r(e);var r,o,i=n(1),a=n.n(i),u=n(6),c=n.n(u),f=n(5),l=n(3),s=n(10),p=n(7),b=n(4),y=n(9),h=n.n(y),d=n(11),m=n(12),v=n(15);function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e,n,r,o,i,a){try{var u=t[i](a),c=u.value}catch(t){return void n(t)}u.done?e(c):Promise.resolve(c).then(r,o)}function g(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var i=t.apply(e,n);function a(t){_(i,r,o,a,u,"next",t)}function u(t){_(i,r,o,a,u,"throw",t)}a(void 0)})}}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var P,E,k,x,z,T,q,R,I,K=68,C=(r=function(t){function e(){var t,n,r,i,a,u,c,f,l,s,p;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var y=arguments.length,d=new Array(y),m=0;m<y;m++)d[m]=arguments[m];return r=this,i=(t=O(e)).call.apply(t,[this].concat(d)),n=!i||"object"!==w(i)&&"function"!=typeof i?S(r):i,a=n,u="state",c=o,f=S(S(n)),c&&Object.defineProperty(a,u,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(f):void 0}),n.fetch={config:{update:["post"]},post:function(){var t=n.params.params.id;return!!t&&n.fetchThenSetState("get_bbs_post-detail","post",{postId:t})},qiniuKey:(l=g(h.a.mark(function t(){var e,r;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=v.a.P("get_qiniu_key"),t.next=3,e;case 3:return r=t.sent,n.setState({qiniuFileKey:r}),t.abrupt("return",e);case 6:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)})},n.do={submit:(p=g(h.a.mark(function t(e,n,r,o){return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.P("do_bbs_posted",{forumId:K,title:e,content:r,json:n,type:1,fileId:o.join()});case 2:window.Stores["/bbs"]&&window.Stores["/bbs"].setRefresh(),b.a.light("发帖成功"),b.a.router.replace("/bbs/1");case 5:case"end":return t.stop()}},t,this)})),function(t,e,n,r){return p.apply(this,arguments)}),update:(s=g(h.a.mark(function t(e,r,o,i){var a;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.params.params.id,t.next=3,v.a.P("do_bbs_post-update",{postId:a,title:e,content:o,json:r,fileId:i.join()});case 3:b.a.light("编辑成功"),b.a.router.back();case 5:case"end":return t.stop()}},t,this)})),function(t,e,n,r){return s.apply(this,arguments)})},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(e,m["a"]),e}(),P=r.prototype,E="state",k=[d.k],x={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.initState({qiniuFileKey:"",post:{}})}},T={},Object.keys(x).forEach(function(t){T[t]=x[t]}),T.enumerable=!!T.enumerable,T.configurable=!!T.configurable,("value"in T||T.initializer)&&(T.writable=!0),T=k.slice().reverse().reduce(function(t,e){return e(P,E,t)||t},T),z&&void 0!==T.initializer&&(T.value=T.initializer?T.initializer.call(z):void 0,T.initializer=void 0),void 0===T.initializer&&(Object.defineProperty(P,E,T),T=null),o=T,r);function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N(t,e){return(N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $=Object(f.c)(C)(q=Object(f.d)((I=R=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),A(this,G(e).apply(this,arguments))}var n,r,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(e,a.a.Component),n=e,(r=[{key:"render",value:function(){if(p.a.__SERVER__)return null;var t=this.context.$,e=t.params.params.id,n=t.getState("qiniuFileKey"),r=t.getState("post"),o=r.title,i=r.json;return e&&!i?null:a.a.createElement(s.k,{title:"发帖",hide:!0,theme:"fullTheme"},a.a.createElement(l.B,{title:o,data:i||void 0,placeholder:"请在这里输入内容",qiniu:!0,qiniuFileKey:n,onQiniuUploadClick:t.fetch.qiniuKey,onOk:function(n,r,o){if(n)if(b.a.getCharLength(o)<20)b.a.light("贴子字数不能少于20");else{var i=JSON.stringify(r),a=b.a.getRealDraftEntityMap(r,!0);e?t.do.update(n,i,o,a):t.do.submit(n,i,o,a)}else b.a.light("请先输入贴子标题")}}))}}])&&J(n.prototype,r),o&&J(n,o),e}(),R.contextTypes={$:c.a.object},q=I))||q)||q;e.default=$},817:function(t,e,n){__NEXT_REGISTER_PAGE("/bbs/post",function(){return t.exports=n(1067),{page:t.exports.default}})}},[[817,1,0]]]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{51:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(a(16)),n=p(a(21)),o=p(a(18)),i=p(a(19)),c=p(a(17)),l=p(a(20)),s=p(a(8)),u=p(a(1));function p(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,i.default)(t,[{key:"componentWillReceiveProps",value:function(){this.noAppearTransition=!0}},{key:"componentDidMount",value:function(){var e=this;this.props.appearTransition&&setTimeout(function(){e.barRef&&(e.barRef.style.width=e.props.percent+"%")},10)}},{key:"render",value:function(){var e,t=this,a=this.props,o=a.className,i=a.prefixCls,c=a.position,l=a.unfilled,p=a.style,f=void 0===p?{}:p,m=a.barStyle,d=void 0===m?{}:m,y={width:this.noAppearTransition||!this.props.appearTransition?this.props.percent+"%":0,height:0},b=(0,s.default)(i+"-outer",o,(e={},(0,n.default)(e,i+"-fixed-outer","fixed"===c),(0,n.default)(e,i+"-hide-outer",!l),e));return u.default.createElement("div",{style:f,className:b,role:"progressbar","aria-valuenow":this.props.percent,"aria-valuemin":0,"aria-valuemax":100},u.default.createElement("div",{ref:function(e){return t.barRef=e},className:i+"-bar",style:(0,r.default)({},d,y)}))}}]),t}(u.default.Component);t.default=f,f.defaultProps={prefixCls:"am-progress",percent:0,position:"fixed",unfilled:!0,appearTransition:!1},e.exports=t.default},946:function(e,t,a){__NEXT_REGISTER_PAGE("/video/post",function(){return e.exports=a(994),{page:e.exports.default}})},994:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),o=a(6),i=a.n(o),c=a(5),l=a(10),s=a(7),u=a(24),p=a(51),f=a.n(p),m=a(2),d=a.n(m),y=a(8),b=a.n(y),g=a(3),_=a(4),h=a(0),v="style-198939",w=function(e,t){var a=t.$,r=e.className,o=a.getState("_upload"),i=o.files,c=o.uploading,l=o.percent,s=o.size,u=a.getState("qiniuFileKey");return i.length?n.a.createElement("div",{className:d.a.dynamic([["1076013288",[h.a.space,h.a.color_theme]]])+" "+(b()(v,r)||"")},n.a.createElement(g.G,{src:i[0].targetPath,poster:_.a.getImgUrl(i[0].surface),fileSize:i[0].size,playSecond:i[0].play_time,placeholderPublish:!0}),n.a.createElement(d.a,{styleId:"1076013288",css:".style-198939.__jsx-style-dynamic-selector{padding:".concat(h.a.space,";background:").concat(h.a.color_theme,";}"),dynamic:[h.a.space,h.a.color_theme]})):n.a.createElement(g.l,{className:b()(v,r),direction:"column",justify:"center"},c?n.a.createElement(n.a.Fragment,null,n.a.createElement(f.a,{percent:l,position:"normal"}),n.a.createElement("p",{className:d.a.dynamic([["1068495392",[h.a.color_theme,v,h.a.color_sub]]])+" t-28 t-sub t-c mt-16"},n.a.createElement("span",{className:d.a.dynamic([["1068495392",[h.a.color_theme,v,h.a.color_sub]]])},"正在上传..."),n.a.createElement("span",{className:d.a.dynamic([["1068495392",[h.a.color_theme,v,h.a.color_sub]]])+" ml-xs"},l,"%"),n.a.createElement("span",{className:d.a.dynamic([["1068495392",[h.a.color_theme,v,h.a.color_sub]]])+" ml-xs"},"(",_.a.getMB(s*(l/100)),"MB/",_.a.getMB(s),"MB)"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(g.F,{qiniu:!0,qiniuFileKey:u,accept:"video/mp4,video/quicktime,video/*",disabled:c,beforeUpload:function(e){return!(e.size/1024/1024>200)||(_.a.light("视频不能超过200M"),!1)},onProgress:a.page.uploadProgress,onSuccess:a.page.videoUploadSuccess},n.a.createElement(g.l,{className:"".concat(v,"__upload"),justify:"center",onClick:a.fetch.qiniuFileKey},n.a.createElement(g.p,{className:"t-48",type:"plus"}))),n.a.createElement("p",{className:d.a.dynamic([["1068495392",[h.a.color_theme,v,h.a.color_sub]]])+" t-30 l-42 t-sub mt-36"},"支持mp4，qt，mov等常用格式，最大支持200M视频")),n.a.createElement(d.a,{styleId:"1068495392",css:".style-198939{min-height:4.08rem;padding:0.4rem 0.8rem;background:".concat(h.a.color_theme,";}.").concat(v,"__upload{width:2.08rem;height:2.08rem;border:0.02rem dashed ").concat(h.a.color_sub,";}"),dynamic:[h.a.color_theme,v,h.a.color_sub]}))};w.contextTypes={$:i.a.object};var E=Object(c.d)(w),S=Object(c.d)(function(e){var t=e.form,a=e.className;return n.a.createElement(g.m,{className:b()("style-873451",a),form:t},n.a.createElement(g.m.Input,{name:"tit",option:s.a.rules.required,placeholder:"请输入标题"}),n.a.createElement(g.m.Textarea,{name:"introCon",placeholder:"请输入描述（选填）",rows:4}))}),O=a(210),j=a.n(O),k=[{label:"原创",value:"1"},{label:"转载",value:"2"}],P=function(e,t){var a=t.$,r=e.className,o=a.getState("_tags"),i=o.from,c=o.tags,l=a.getState("tags");return n.a.createElement(g.u,{className:b()("style-281344",r)},n.a.createElement(j.a,{data:k,cols:1,title:"选择视频来源",extra:"请选择",value:[i],onOk:function(e){return a.setState({from:e[0]},"_tags")}},n.a.createElement(g.u.Item,{arrow:"horizontal"},"视频来源")),n.a.createElement(g.u.Item,null,n.a.createElement("span",{className:d.a.dynamic([["824724938",[h.a.sm,h.a.md,h.a.md,h.a.color_sub,h.a.border,h.a.color_primary,h.a.color_primary]]])},"选择标签"),n.a.createElement("div",{className:d.a.dynamic([["824724938",[h.a.sm,h.a.md,h.a.md,h.a.color_sub,h.a.border,h.a.color_primary,h.a.color_primary]]])+" mt-md"},l.list.map(function(e){return n.a.createElement("div",{key:e.labelId,onClick:function(){return a.page.tagClick(e.labelId)},className:d.a.dynamic([["824724938",[h.a.sm,h.a.md,h.a.md,h.a.color_sub,h.a.border,h.a.color_primary,h.a.color_primary]]])+" "+(b()("tag t-30 l-48",{"tag-active":!!c.find(function(t){return t===e.labelId})})||"")},e.labelvalue)}))),n.a.createElement(d.a,{styleId:"824724938",css:".tag.__jsx-style-dynamic-selector{display:inline-block;padding:0 ".concat(h.a.sm,";margin:0 ").concat(h.a.md," ").concat(h.a.md," 0;color:").concat(h.a.color_sub,";border-radius:0.28rem;border:").concat(h.a.border,";-webkit-transition:0.3s all;transition:0.3s all;}.tag-active.__jsx-style-dynamic-selector{color:#fff;background:").concat(h.a.color_primary,";border:0.01rem solid ").concat(h.a.color_primary,";}"),dynamic:[h.a.sm,h.a.md,h.a.md,h.a.color_sub,h.a.border,h.a.color_primary,h.a.color_primary]}))};P.contextTypes={$:i.a.object};var x,N,z=Object(c.d)(P),T=a(9),I=a.n(T),q=a(11),C=a(12),F=a(15);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){R(e,t,a[t])})}return e}function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function $(e,t,a,r,n,o,i){try{var c=e[o](i),l=c.value}catch(e){return void a(e)}c.done?t(l):Promise.resolve(l).then(r,n)}function U(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var o=e.apply(t,a);function i(e){$(o,r,n,i,c,"next",e)}function c(e){$(o,r,n,i,c,"throw",e)}i(void 0)})}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var J,W,H,L,V,X,Y,Q,Z,ee=(x=function(e){function t(){var e,a,r,n,o,i,c,l,s,u,p;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var f=arguments.length,m=new Array(f),d=0;d<f;d++)m[d]=arguments[d];return r=this,n=(e=B(t)).call.apply(e,[this].concat(m)),a=!n||"object"!==M(n)&&"function"!=typeof n?G(r):n,o=a,i="state",c=N,l=G(G(a)),c&&Object.defineProperty(o,i,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(l):void 0}),a.fetch={config:{one:["tags"]},qiniuFileKey:(s=U(I.a.mark(function e(){var t,r;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.getState("qiniuFileKey")){e.next=3;break}return e.abrupt("return",!1);case 3:return t=F.a.P("get_qiniu_key"),e.next=6,t;case 6:return r=e.sent,a.setState(r,"qiniuFileKey"),e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)}),tags:function(){return a.fetchThenSetState("get_video_label","tags",{_:{limit:0,search:{labelType:2}}})}},a.do={_submit:function(e,t){return t(e,a.do.submit)},submit:(u=U(I.a.mark(function e(t){var r,n,o,i,c;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.getState("_upload"),n=r.files,o=a.getState("_tags"),i=o.from,c=o.tags,n.length){e.next=5;break}return _.a.light("请上传视频"),e.abrupt("return");case 5:return e.next=7,F.a.P("do_video-v2_add",A({fileId:n[0].fileId,from:i,tag:c.join(",")},t));case 7:window.Stores["/video"]&&window.Stores["/video"].setRefresh(),_.a.light("发布成功"),a.page.reset(),_.a.router.back();case 11:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},a.page={reset:function(){a.setState({files:[],uploading:!1,percent:0,size:0},"_upload"),a.setState({from:"",tags:[]},"_tags"),a.setState("","qiniuFileKey")},uploadProgress:function(e,t){var r=Math.round(e.percent);a.setState({uploading:!0,percent:r,size:t.size},"_upload")},videoUploadSuccess:(p=U(I.a.mark(function e(t){var r,n;return I.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("success"===t.ret){e.next=5;break}return a.setState({files:[],type:"video",percent:0,size:0,uploading:!1}),_.a.light("视频上传失败，请重试。"),a.setState("","qiniuFileKey"),e.abrupt("return");case 5:return r=a.getState("qiniuFileKey"),e.next=8,F.a.P("get_qiniu_file-info",{key:r});case 8:n=e.sent,a.setState({files:[{fileId:r,name:n.hash,play_time:n.playTime,size:n.fsize,surface:n.surImg,targetPath:n.filePath,type:"mp4"}],type:"video",percent:0,size:0,uploading:!1},"_media");case 10:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)}),tagClick:function(e){var t,r=a.getState("_tags").tags;t=r.find(function(t){return t===e})?r.filter(function(t){return t!==e}):K(r).concat([e]),a.setState({tags:t},"_tags")}},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,C["a"]),t}(),J=x.prototype,W="state",H=[q.k],L={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.initState({_upload:{files:[],uploading:!1,percent:0,size:0},_tags:{from:_.a.getValue(k,"原创"),tags:[]},qiniuFileKey:"",tags:s.a.__EMPTY__})}},X={},Object.keys(L).forEach(function(e){X[e]=L[e]}),X.enumerable=!!X.enumerable,X.configurable=!!X.configurable,("value"in X||X.initializer)&&(X.writable=!0),X=H.slice().reverse().reduce(function(e,t){return t(J,W,e)||e},X),V&&void 0!==X.initializer&&(X.value=X.initializer?X.initializer.call(V):void 0,X.initializer=void 0),void 0===X.initializer&&(Object.defineProperty(J,W,X),X=null),N=X,x);function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t){return!t||"object"!==te(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ie=Object(c.c)(ee)(Y=Object(c.a)(Y=Object(c.d)((Z=Q=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),re(this,ne(t).apply(this,arguments))}var a,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,n.a.Component),a=t,(r=[{key:"componentDidMount",value:function(){var e=this.context.$,t=this.props,a=t.form,r=t.onSubmit;u.a.header({ft:n.a.createElement("span",{className:"t-34 l-48 t-primary",onClick:function(){return e.do._submit(a,r)}},"发布")})}},{key:"componentWillUnmount",value:function(){u.a.resetHeader()}},{key:"render",value:function(){if(!s.a.__CLIENT__)return null;var e=this.props.form;return n.a.createElement(l.k,{title:"发布视频"},n.a.createElement(E,null),n.a.createElement(S,{className:"mt-d",form:e}),n.a.createElement(z,{className:"mt-d"}))}}])&&ae(a.prototype,r),o&&ae(a,o),t}(),Q.contextTypes={$:i.a.object},Y=Z))||Y)||Y)||Y;t.default=ie}},[[946,1,0]]]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{1029:function(e,t,a){"use strict";a.r(t);var n,r,o=a(2),i=a.n(o),c=a(1),l=a.n(c),s=a(6),p=a.n(s),u=a(8),m=a.n(u),d=a(5),f=a(3),b=a(10),w=a(7),y=a(4),h=a(0),g=a(13),_=a(9),k=a.n(_),v=a(11),M=a(12),E="style-162266";function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,a,n,r,o,i){try{var c=e[o](i),l=c.value}catch(e){return void a(e)}c.done?t(l):Promise.resolve(l).then(n,r)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var I,N,j,C,P,T,z,R,D,B=(n=function(e){function t(){var e,a,n,o,i,c,l,s,p,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var m=arguments.length,d=new Array(m),f=0;f<m;f++)d[f]=arguments[f];return n=this,o=(e=x(t)).call.apply(e,[this].concat(d)),(a=!o||"object"!==L(o)&&"function"!=typeof o?O(n):o).map=void 0,a.circle=void 0,a.fakeLocationMarker=void 0,a.markers=[],a.geo={count:0,lng:null,lat:null},a.needRefreshList=!1,a.needDropAnimate=!1,a.lastSelectMarkerIndex=null,i=a,c="state",l=r,s=O(O(a)),l&&Object.defineProperty(i,c,{enumerable:l.enumerable,configurable:l.configurable,writable:l.writable,value:l.initializer?l.initializer.call(s):void 0}),a.fetch={config:{},shopList:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return a.fetchThenSetState("get_merchant_shop-list","shopList",{_:{limit:2*w.a.__LIMIT__,search:{userLon:e,userLat:t,distance:n}}})}},a.page={initMap:function(){if(a.geo.count){var e=a.geo,t=e.lng,n=e.lat;a.map=new window.AMap.Map("amap",{zoom:13,center:new window.AMap.LngLat(t,n),features:["bg","road","point"]}),a.fakeLocationMarker=new window.AMap.Marker({content:'<img style="position:relative;cursor:pointer;" width="23px" height="23px" src="https://webapi.amap.com/theme/v1.3/markers/b/loc.png">',position:new window.AMap.LngLat(t,n),offset:new window.AMap.Pixel(-12,-12),map:a.map})}else a.map=new window.AMap.Map("amap",{zoom:13,features:["bg","road","point"]});window.AMap.plugin(["AMap.ToolBar","AMap.Scale"],function(){return a.map.addControl(new window.AMap.ToolBar),void a.map.addControl(new window.AMap.Scale)}),a.page.geolocation()},geolocation:function(){a.map.plugin("AMap.Geolocation",function(){var e=new window.AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4,convert:!0,showButton:!0,buttonPosition:"LB",buttonOffset:new window.AMap.Pixel(10,50),showMarker:!0,showCircle:!0,panToLocation:!0});a.map.addControl(e),window.AMap.event.addListener(e,"complete",function(e){var t=e.position,n=t.lng,r=t.lat;a.geo={count:0,lng:n,lat:r},a.fakeLocationMarker&&a.fakeLocationMarker.setMap(null),a.needRefreshList=!0,a.page.setCircle(),a.page.getList(),a.geo.count=a.geo.count+1}),window.AMap.event.addListener(e,"error",function(){y.a.light("定位失败，请点击地图左下方按钮重新定位")}),0===a.geo.count?e.getCurrentPosition():(a.page.setCircle(),a.page.getList())})},getList:(p=k.a.mark(function e(){var t,n,r,o;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.geo,n=t.lng,r=t.lat,!a.needRefreshList){e.next=9;break}return a.needRefreshList=!1,a.needDropAnimate=!0,e.next=6,a.fetch.shopList(n,r);case 6:o=e.sent,e.next=10;break;case 9:o=a.getState("shopList");case 10:window.AMapUI.loadUI(["overlay/SimpleMarker"],function(e){a.markers.length&&(a.markers.forEach(function(e){e.setMap(null)}),a.markers=[]),a.needDropAnimate?(a.needDropAnimate=!1,o.list.forEach(function(t,n){setTimeout(function(){var r=new e({map:a.map,animation:"AMAP_ANIMATION_DROP",containerClassNames:"".concat(E,"__marker"),iconTheme:"numv1",iconStyle:"red-".concat(n+1),position:[t.lon,t.lat],clickable:!0});r.on("click",function(){a.page.selectMarker(n,!0)}),a.markers.push(r)},160*n)})):o.list.forEach(function(t,n){var r=new e({map:a.map,containerClassNames:"".concat(E,"__marker"),iconTheme:"numv1",iconStyle:"red-".concat(n+1),position:[t.lon,t.lat],clickable:!0});r.on("click",function(){a.page.selectMarker(n,!0)}),a.markers.push(r)})});case 11:case"end":return e.stop()}},e,this)}),u=function(){var e=this,t=arguments;return new Promise(function(a,n){var r=p.apply(e,t);function o(e){S(r,a,n,o,i,"next",e)}function i(e){S(r,a,n,o,i,"throw",e)}o(void 0)})},function(){return u.apply(this,arguments)}),setCircle:function(){var e=a.geo,t=e.lng,n=e.lat;a.circle&&a.circle.setMap(null),a.circle=new window.AMap.Circle({center:new window.AMap.LngLat(t,n),radius:1e3,strokeColor:h.a.color_primary,strokeOpacity:.8,strokeWeight:1,fillColor:h.a.color_primary,fillOpacity:.24}),a.circle.setMap(a.map)},selectMarker:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=a.getState("shopList");a.setState({selectMarkerIndex:e});var r=n.list[e],o=r.lon,i=r.lat;a.map.setCenter(new window.AMap.LngLat(o,i)),null!==a.lastSelectMarkerIndex&&a.markers[a.lastSelectMarkerIndex].setIconStyle("red-".concat(a.lastSelectMarkerIndex+1)),a.markers[e].setIconStyle("blue-".concat(e+1)),a.lastSelectMarkerIndex=e,t&&y.a.scrollTo(document.querySelector(".".concat(E,"__item-").concat(e)).offsetTop)}},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,M["a"]),t}(),I=n.prototype,N="state",j=[v.k],C={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.initState({state:{selectMarkerIndex:null},shopList:w.a.__EMPTY__})}},T={},Object.keys(C).forEach(function(e){T[e]=C[e]}),T.enumerable=!!T.enumerable,T.configurable=!!T.configurable,("value"in T||T.initializer)&&(T.writable=!0),T=j.slice().reverse().reduce(function(e,t){return t(I,N,e)||e},T),P&&void 0!==T.initializer&&(T.value=T.initializer?T.initializer.call(P):void 0,T.initializer=void 0),void 0===T.initializer&&(Object.defineProperty(I,N,T),T=null),r=T,n);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function J(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function U(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=Object(d.b)(B)(z=Object(d.d)((D=R=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,W(t).apply(this,arguments))}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(t,l.a.Component),a=t,(n=[{key:"componentDidMount",value:function(){if(w.a.__CLIENT__){var e=this.context.$;y.a.removeHD(),g.a.loadAMapJS(function(){return e.page.initMap()})}}},{key:"componentWillUnmount",value:function(){w.a.__CLIENT__&&y.a.setHD()}},{key:"render",value:function(){var e=this.context.$,t=e.getState().selectMarkerIndex,a=e.getState("shopList").list;return l.a.createElement(b.k,{className:E,title:"附近经销商",hide:!0},l.a.createElement("div",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" wrap-map"},l.a.createElement(f.l,{className:"".concat(E,"__btn-back"),justify:"center",onClick:y.a.router.back},l.a.createElement(f.p,{className:"t-36 t-void",type:"left"})),l.a.createElement(f.l,{className:"".concat(E,"__btn-home"),justify:"center",href:"/"},l.a.createElement(f.p,{className:"t-36 t-void",type:"home-fill"})),l.a.createElement("div",{id:"amap",className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" amap"})),l.a.createElement(f.u,{className:"".concat(E,"__list")},a.map(function(a,n){var r;return l.a.createElement(f.u.Item,{key:a.allianceId,className:"".concat(E,"__item-").concat(n),thumb:l.a.createElement("div",{onClick:function(){return e.page.selectMarker(n)},className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" "+(m()((r={"amap-simple-marker":!0,"amap-simple-marker-numv1-style":!0},H(r,"".concat(E,"__marker"),!0),H(r,"amap-simple-marker-style-red-".concat(n+1),t!==n),H(r,"amap-simple-marker-style-blue-".concat(n+1),t===n),r))||"")},l.a.createElement("div",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" amap-simple-marker-icon"}))},l.a.createElement(f.l,{wrap:"wrap"},l.a.createElement(f.l.Item,{className:"ml-sm",href:"/nearby/detail?id=".concat(a.allianceId),as:"/nearby/detail/".concat(a.allianceId)},l.a.createElement("p",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" t-32"},l.a.createElement("span",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])},a.shopName),l.a.createElement("span",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" t-24"}," | "),l.a.createElement("span",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" t-24 t-sub"},(a.distance/1e3).toFixed(2),"km")),l.a.createElement("p",{className:i.a.dynamic([["1411058785",[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]],["152378369",[h.a.border]]])+" p-address t-24 t-sub mt-8"},"地址：",a.address||"-")),l.a.createElement(f.q,{className:"".concat(E,"__thumb ml-sm"),src:a.shopFace,lazyload:!0,animate:!0,size:"1rem",style:{minWidth:"1.6rem"},onClick:function(){return e.page.selectMarker(n)}})))})),l.a.createElement(i.a,{styleId:"1411058785",css:".style-162266{padding-bottom:0 !important;}.".concat(E,"__btn-back{position:absolute;z-index:1000;top:").concat(h.a.space,";left:").concat(h.a.wind,";width:0.64rem;height:0.64rem;background:rgba(0,0,0,0.64);border-radius:50%;opacity:0.8;}.").concat(E,"__btn-home{position:absolute;z-index:1000;top:").concat(h.a.space,";right:").concat(h.a.wind,";width:0.64rem;height:0.64rem;background:rgba(0,0,0,0.64);border-radius:50%;opacity:0.8;}.").concat(E,"__marker{width:0.576rem !important;height:0.576rem !important;}.").concat(E,"__list{margin-top:75%;}.").concat(E,"__thumb{border:").concat(h.a.border,";}"),dynamic:[E,h.a.space,h.a.wind,E,h.a.space,h.a.wind,E,E,E,h.a.border]}),l.a.createElement(i.a,{styleId:"152378369",css:".wrap-map.__jsx-style-dynamic-selector{position:fixed;z-index:100;top:0;left:0;right:0;}.amap.__jsx-style-dynamic-selector{position:relative;padding-bottom:75%;background:#fcf9f2;border-bottom:".concat(h.a.border,";overflow:hidden;}.p-address.__jsx-style-dynamic-selector{white-space:initial;}"),dynamic:[h.a.border]}))}}])&&J(a.prototype,n),r&&J(a,r),t}(),R.contextTypes={$:p.a.object},z=D))||z)||z;t.default=q},847:function(e,t,a){__NEXT_REGISTER_PAGE("/nearby",function(){return e.exports=a(1029),{page:e.exports.default}})}},[[847,1,0]]]);
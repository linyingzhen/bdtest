(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{428:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(822)),a=u(n(823)),o=u(n(339)),i=u(n(18)),s=u(n(19)),c=u(n(17)),l=u(n(20));function u(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];(0,i.default)(this,t);var l=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this)),u={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};l.url=e,l.protocols=s;var m=(0,a.default)(u),f=!0,d=!1,p=void 0;try{for(var h,y=(0,r.default)(m);!(f=(h=y.next()).done);f=!0){var v=h.value;l[v]=v in n?n[v]:u[v]}}catch(e){d=!0,p=e}finally{try{!f&&y.return&&y.return()}finally{if(d)throw p}}l.ws=null,l.forcedClose=!1,l.timedOut=!1,l.reconnectAttempts=0,l.readyState=WebSocket.CONNECTING,l.protocol=null;var g=!0,b=!1,_=void 0;try{for(var w,E=(0,r.default)(["onconnecting","onopen","onclose","onmessage","onerror"]);!(g=(w=E.next()).done);g=!0){var k=w.value;l[k]=function(e){return e}}}catch(e){b=!0,_=e}finally{try{!g&&E.return&&E.return()}finally{if(b)throw _}}return l.on("connecting",function(e){l.onconnecting(e)}),l.on("open",function(e){l.onopen(e)}),l.on("close",function(e){l.onclose(e)}),l.on("message",function(e){l.onmessage(e)}),l.on("error",function(e){l.onerror(e)}),!0===l.automaticOpen&&l.open(!1),l.CONNECTING=WebSocket.CONNECTING,l.OPEN=WebSocket.OPEN,l.CLOSING=WebSocket.CLOSING,l.CLOSED=WebSocket.CLOSED,l.DEFAULT_CODE=1e3,l}return(0,l.default)(t,e),(0,s.default)(t,[{key:"dbg",value:function(){var e;this.debug&&(e=console).debug.apply(e,arguments)}},{key:"open",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=t;if(this.ws=new WebSocket(this.url,this.protocols),this.ws.binaryType=this.binaryType,t){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else this.emit("connecting",{isReconnect:n}),this.reconnectAttempts=0;this.dbg("RWS","attempt-connect",this.url),this.timeout=setTimeout(function(){e.dbg("RWS","connection-timeout",e.url),e.timedOut=!0,e.ws.close(),e.timedOut=!1},this.timeoutInterval),this.ws.onopen=function(t){clearTimeout(e.timeout),e.dbg("RWS","onopen",e.url),e.protocol=e.ws.protocol,e.readyState=WebSocket.OPEN,e.reconnectAttempts=0,t.isReconnect=n,e.emit("open",t),n=!1},this.ws.onclose=function(t){if(clearTimeout(e.timeout),e.ws=null,e.forcedClose)e.readyState=WebSocket.CLOSED,e.emit("close");else{e.reconnectAttempts||e.timeout||(e.dbg("RWS","onclose",e.url),e.emit("close")),t.isReconnect=!0,e.emit("connecting",t);var n=e.reconnectInterval*Math.pow(e.reconnectDecay,e.reconnectAttempts);setTimeout(function(){e.reconnectAttempts++,e.open(!0)},n>e.maxReconnectInterval?e.maxReconnectInterval:n)}},this.ws.onmessage=function(t){e.dbg("RWS","onmessage",e.url,t.data),e.emit("message",t)},this.ws.onerror=function(t){e.dbg("RWS","onerror",e.url,t),e.emit("error",t)}}},{key:"send",value:function(e){if(this.ws)return this.dbg("RWS","send",this.url,e),this.ws.send(e);throw new Error("INVALID_STATE_ERR")}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.DEFAULT_CODE,t=arguments[1];this.forcedClose=!0,this.ws&&this.ws.close(e,t)}},{key:"refresh",value:function(){this.ws&&this.ws.close()}}]),t}(u(n(824)).default);t.default=m},821:function(e,t,n){__NEXT_REGISTER_PAGE("/chat",function(){return e.exports=n(964),{page:e.exports.default}})},822:function(e,t,n){e.exports={default:n(321),__esModule:!0}},823:function(e,t,n){e.exports={default:n(307),__esModule:!0}},824:function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,c,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),i=(l=n.slice()).length,c=0;c<i;c++)l[c].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function a(){this.removeListener(e,a),n||(n=!0,t.apply(this,arguments))}return a.listener=t,this.on(e,a),this},n.prototype.removeListener=function(e,t){var n,o,i,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=i;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},964:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),o=n(1),i=n.n(o),s=n(6),c=n.n(s),l=n(5),u=n(3),m=n(10),f=n(0),d=n(4),p=Object(l.d)(function(e){var t=e.ctime;return i.a.createElement("div",{className:"t-c t-xs t-sub mt-lg"},d.a.date("m-d H:i",t))}),h=n(8),y=n.n(h),v=function(e,t){var n=t.$,r=e.message,o=e.con,s=e.img,c=e.isMe,l=e.className,m=o,p=s;if(r){var h={value:""};try{h=JSON.parse(r)}catch(e){console.warn(e)}m=h.value,p=h.id}return i.a.createElement("div",{className:a.a.dynamic([["3137811533",[f.a.sm,f.a.color_theme,f.a.color_theme,f.a.color_primary,f.a.color_primary]]])+" "+(y()(l,"content",{"content-me":c,"content-img":!!p})||"")},p?i.a.createElement("img",{src:d.a.getAppImgUrl(p,"scale",!0),alt:"",onClick:function(){return n.page.showImgView(p)},className:a.a.dynamic([["3137811533",[f.a.sm,f.a.color_theme,f.a.color_theme,f.a.color_primary,f.a.color_primary]]])+" image"}):i.a.createElement(u.e,{style:{wordBreak:"break-all"}},m),i.a.createElement(a.a,{styleId:"3137811533",css:".content.__jsx-style-dynamic-selector{position:relative;padding:".concat(f.a.sm,";background-color:").concat(f.a.color_theme,";border-radius:0.08rem;}.content.__jsx-style-dynamic-selector:before{content:'';position:absolute;top:0.16rem;left:0;margin-left:-0.12rem;border-top:0.12rem solid transparent;border-bottom:0.12rem solid transparent;border-right:0.12rem solid ").concat(f.a.color_theme,";}.content-me.__jsx-style-dynamic-selector{background-color:").concat(f.a.color_primary,";}.content-me.__jsx-style-dynamic-selector:before{top:0.16rem;left:initial;right:0;margin-left:initial;margin-right:-0.12rem;border-top:0.12rem solid transparent;border-right:0;border-bottom:0.12rem solid transparent;border-left:0.12rem solid ").concat(f.a.color_primary,";}.content-img.__jsx-style-dynamic-selector{padding:0;}.content-img.__jsx-style-dynamic-selector:before{content:initial;}.image.__jsx-style-dynamic-selector{display:inline-block;vertical-align:top;min-width:1.2rem;height:initial;max-width:56vw;max-height:56vh;border-radius:0.08rem;}"),dynamic:[f.a.sm,f.a.color_theme,f.a.color_theme,f.a.color_primary,f.a.color_primary]}))};v.contextTypes={$:c.a.object};var g=Object(l.d)(v),b=Object(l.d)(function(e){var t=e.userId,n=e.faceImg;return i.a.createElement(u.l,{className:"style-501567",align:"start"},i.a.createElement(m.c,{userId:t,img:n}),i.a.createElement(u.l,{className:"ml-sm",direction:"column",align:"start"},i.a.createElement(g,e)),i.a.createElement(a.a,{styleId:"576651821",css:".style-501567{padding-right:1.24rem;margin-top:0.24rem;}.".concat("style-501567"," .am-flexbox{overflow-y:initial;}"),dynamic:["style-501567"]}))});function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var w,E,k,S=Object(l.d)(function(e){var t=e.userId,n=e.faceImg;return i.a.createElement(u.l,{className:"style-998717",align:"start",justify:"end"},i.a.createElement(u.l,{className:"mr-sm",direction:"column",align:"end",justify:"start"},i.a.createElement(g,_({className:"t-void",isMe:!0},e))),i.a.createElement(m.c,{userId:t,img:n}),i.a.createElement(a.a,{styleId:"2539093451",css:".style-998717{padding-left:1.24rem;margin-top:0.24rem;}.".concat("style-998717"," .am-flexbox{overflow-y:initial;}"),dynamic:["style-998717"]}))}),O=Object(l.d)(function(e){var t=e.onUploadImageSuccess,n=void 0===t?Function.prototype:t,r=e.disabled;return i.a.createElement(i.a.Fragment,null,i.a.createElement(u.p,{className:"t-56 t-sub",type:"pic",onClick:function(){r||document.querySelector(".".concat("style-182547","__upload-image > input")).click()}}),i.a.createElement(u.F,{className:"".concat("style-182547","__upload-image"),data:{iswatermark:1},beforeUpload:function(){return d.a.loading("上传中...")},style:{display:"none"},onSuccess:function(e){var t=e.code,r=e.data;d.a.hideToast(),0===t?n("".concat(r.targetPath,"/").concat(r.name)):d.a.light("文件上传失败, ".concat(e.err))}}))});function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T,P,L=Object(l.d)((k=E=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,N(t).apply(this,arguments))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,i.a.Component),n=t,(r=[{key:"componentDidUpdate",value:function(){var e=this.textareaRef;e.scrollHeight>240||(e.style.height="",e.style.height="".concat(e.scrollHeight,"px"))}},{key:"render",value:function(){var e=this,t=this.props.className,n=this.context.$,r=n.getState(),o=r.socketConnectFail,s=r.showEmoji,c=r.value;return i.a.createElement("div",{className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" "+(y()("style-179152",t)||"")},i.a.createElement(u.l,{className:"".concat("style-179152","__form")},s?i.a.createElement(u.p,{className:"t-56 t-sub",type:"keyboard",onClick:function(){n.page.hideEmojiPicker(),document.querySelector("textarea").focus()}}):i.a.createElement(u.p,{className:"t-56 t-sub",type:"emoji",onClick:function(){o||n.page.toggleEmojiPicker()}}),i.a.createElement(u.l.Item,{className:"ml-sm",style:{position:"relative"}},i.a.createElement("div",{className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" textarea am-list-item am-textarea-item"},i.a.createElement("div",{className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" am-textarea-control"},i.a.createElement("textarea",{ref:function(t){return e.textareaRef=t},rows:"1",value:c,disabled:o,placeholder:o?"私聊服务连接失败，请稍后再试":void 0,onFocus:function(){return n.page.hideEmojiPicker()},onChange:function(t){n.page.onTextareaChange(t.target.value),e.componentDidUpdate()},className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" "+"".concat("style-179152","__textarea")})))),i.a.createElement("div",{className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" extra t-c ml-sm"},c?i.a.createElement(u.c,{type:"primary",size:"sm",inline:!0,onClick:n.do.comment},"发送"):i.a.createElement(O,{disabled:o,onUploadImageSuccess:function(e){return d.a.onConfirm(i.a.createElement("div",{className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" t-c"},i.a.createElement("p",{className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])},"确定发送图片?"),i.a.createElement("img",{src:d.a.getAppImgUrl(e,"scale"),style:{width:"100%"},alt:"",className:a.a.dynamic([["698536745",[f.a.color_theme,f.a.border,"style-179152"]],["2538380430",[f.a.border]]])+" mt-d"})),function(){return n.do.comment({id:e})})}}))),s&&i.a.createElement(u.h,{className:"".concat("style-179152","__emoji-picker"),onPick:n.page.onEmojiPick}),i.a.createElement(a.a,{styleId:"698536745",css:".style-179152{width:100%;background:".concat(f.a.color_theme,";border-top:").concat(f.a.border,";}.").concat("style-179152","__form{padding:0.12rem 0.12rem 0.08rem;}"),dynamic:[f.a.color_theme,f.a.border,"style-179152"]}),i.a.createElement(a.a,{styleId:"2538380430",css:".textarea.__jsx-style-dynamic-selector{padding-left:0 !important;}.textarea.__jsx-style-dynamic-selector .am-textarea-control{padding:0;padding-right:0.56rem !important;border-bottom:".concat(f.a.border,";}.extra.__jsx-style-dynamic-selector{width:1rem;}"),dynamic:[f.a.border]}))}}])&&x(n.prototype,r),o&&x(n,o),t}(),E.contextTypes={$:c.a.object},w=k))||w,A=n(9),R=n.n(A),U=n(428),D=n.n(U),W=n(11),M=n(12),F=n(15),H=n(7),J=n(13),z=".".concat("style-917444","__wrap");function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){q(e,t,n[t])})}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function X(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){B(o,r,a,i,s,"next",e)}function s(e){B(o,r,a,i,s,"throw",e)}i(void 0)})}}function Y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ee,te,ne,re,ae,oe,ie=(T=function(e){function t(){var e,n,r,a,o,i,s,c,l,u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var m=arguments.length,f=new Array(m),p=0;p<m;p++)f[p]=arguments[p];return r=this,a=(e=K(t)).call.apply(e,[this].concat(f)),(n=!a||"object"!==V(a)&&"function"!=typeof a?Z(r):a).socket=void 0,n.tk=void 0,n.DS=[],n.realHeight=0,o=n,i="state",s=P,c=Z(Z(n)),s&&Object.defineProperty(o,i,{enumerable:s.enumerable,configurable:s.configurable,writable:s.writable,value:s.initializer?s.initializer.call(c):void 0}),n.fetch={config:{static:["userInfo"],update:["chatList"]},userInfo:(u=X(R.a.mark(function e(){var t;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=J.a.fetchUserInfo(),e.t0=n,e.next=4,t;case 4:return e.t1=e.sent,e.t0.setState.call(e.t0,e.t1,"userInfo"),e.abrupt("return",t);case 7:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)}),toUserInfo:function(){var e=n.params.params.id;return n.fetchThenSetState("get_person_info","toUserInfo",{userId:e})},chatNum:function(){return n.fetchThenSetState("get_chat_online-num","chatNum")},chatList:(l=X(R.a.mark(function e(){var t,r,a;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.params.params.id,r=t?F.a.P("get_chat_private-list",{_:{limit:100,order:{createTime:"desc"},search:{userId:t}}}):F.a.P("get_chat_logs",{_:{limit:80,order:{createTime:"desc"},search:{groupId:1}}}),e.next=4,r;case 4:return a=e.sent,n.setState($({},a,{list:a.list.reverse()}),"chatList"),e.abrupt("return",r);case 7:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},n.do={comment:function(e){var t=e.id,r=n.getState().value,a=n.getState("userInfo"),o=a.userId,i=a.faceImg,s=a.niname;try{n.socket.send(JSON.stringify({servicename:"socketweb.sendmsg",params:{tk:n.tk,toUserId:n.params.params.id||"",groupId:n.params.params.id?0:1,message:JSON.stringify(t?{id:t}:{value:r})}}))}catch(e){d.a.light("发送消息失败，请稍后再试")}n.setState({showEmoji:!1,value:""}),n.params.params.id&&n.page.append({userId:o,faceImg:i,niname:s,message:JSON.stringify(t?{id:t}:{value:r}),createTime:Math.floor((new Date).valueOf()/1e3)},!0)}},n.page={socketConnectFailCb:function(){n.setState({socketConnectFail:!0}),d.a.light("私聊服务连接失败，请稍后再试"),n.page.destorySocket()},destorySocket:function(){n.socket&&n.socket.close(),n.socket=null},append:function(e,t){var r,a=n.getState("chatList");r=e?G(a.list).concat([e]):G(n.DS).concat(G(a.list)),n.setState({list:r},"chatList"),setTimeout(function(){var e=document.querySelector(z);0===n.realHeight?e.childNodes.forEach(function(e){n.realHeight+=e.offsetHeight}):n.realHeight+=e.childNodes[e.childNodes.length-1].offsetHeight;var r=e.scrollTop;(t||(n.realHeight-r)/H.a.__DPR__<800)&&(e.scrollTop=99999)},0)},onTextareaChange:function(e){return n.setState({value:e})},onEmojiPick:function(e){var t=n.getState().value;n.setState({value:"".concat(t).concat(e)})},toggleEmojiPicker:function(){var e=n.getState().showEmoji;n.setState({showEmoji:!e})},hideEmojiPicker:function(){return n.setState({showEmoji:!1})},showImgView:function(e){return n.setState({imgView:{show:!0,current:0,data:[d.a.getAppImgUrl(e,"scale",!0)]}})},hideImgView:function(){return n.setState({imgView:{show:!1,current:0,data:[]}})}},n.socketOpenPrivateChat=function(){var e=n.params.params.id;if(e)try{n.socket.send(JSON.stringify({servicename:"socketweb.openPrivateChat",params:{tk:n.tk,toUserId:e}}))}catch(e){console.warn("私聊服务连接失败")}},n.socketExitPrivateChat=function(){var e=n.params.params.id;if(e)try{n.socket.send(JSON.stringify({servicename:"socketweb.exitPrivateChat",params:{tk:n.tk,toUserId:e}}))}catch(e){n.page.destorySocket(),console.warn("离开聊天室请求失败")}},n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,M["a"]),n=t,(r=[{key:"storeDidMount",value:function(){var e=this,t=this.params.params.id;t&&this.fetch.toUserInfo();try{this.socket?this.socketOpenPrivateChat():(this.socket=new D.a(H.a.__WSS__),this.socket.onmessage=function(n){var r,a,o=e.getState("userInfo").userId;try{r=JSON.parse(n.data),a=JSON.parse(r.message)}catch(e){console.error(e)}a&&t===r.userId&&(a.id?e.page.append({userId:r.userId,faceImg:r.faceImg,niname:r.niname,img:a.id,con:"",createTime:Math.floor((new Date).valueOf()/1e3)},o===r.userId):e.page.append({userId:r.userId,faceImg:r.faceImg,niname:r.niname,img:"",con:a.value,createTime:Math.floor((new Date).valueOf()/1e3)},o===r.userId))},this.socket.onerror=function(){e.page.socketConnectFailCb()})}catch(e){this.page.socketConnectFailCb()}this.socket.onopen=function(){e.tk=J.a.getState("tk");var n={servicename:"socketweb.pushmsg",params:{tk:e.tk,groupId:t?0:1}};try{e.socket.send(JSON.stringify(n))}catch(e){console.warn("告诉服务器接受推送消息失败")}e.socketOpenPrivateChat()}}},{key:"storeWillUnmount",value:function(){this.socketExitPrivateChat(),this.page.destorySocket(),this.realHeight=0,this.setState({socketConnectFail:!1})}}])&&Y(n.prototype,r),a&&Y(n,a),t}(),ee=T.prototype,te="state",ne=[W.k],re={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.initState({state:{socketConnectFail:!1,showEmoji:!1,value:"",imgView:{show:!1,current:0,data:[]}},userInfo:J.a.getState("userInfo"),toUserInfo:{},chatNum:{},chatList:H.a.__EMPTY__})}},oe={},Object.keys(re).forEach(function(e){oe[e]=re[e]}),oe.enumerable=!!oe.enumerable,oe.configurable=!!oe.configurable,("value"in oe||oe.initializer)&&(oe.writable=!0),oe=ne.slice().reverse().reduce(function(e,t){return t(ee,te,e)||e},oe),ae&&void 0!==oe.initializer&&(oe.value=oe.initializer?oe.initializer.call(ae):void 0,oe.initializer=void 0),void 0===oe.initializer&&(Object.defineProperty(ee,te,oe),oe=null),P=oe,T);function se(){return(se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var ce=function(e,t){var n=t.$,r=n.getState().imgView,o=n.getState("userInfo").userId,s=n.getState("toUserInfo").niname,c=n.getState("chatList");return i.a.createElement(m.k,{className:"style-917444",title:s||"聊天",wrapStyle:{position:"initial"}},i.a.createElement(u.l,{className:"".concat("style-917444","__container"),direction:"column"},i.a.createElement(u.l.Item,{className:"".concat("style-917444","__wrap")},c.list.map(function(e,t){var n;return 0===t?n=!0:e.createTime-c.list[t-1].createTime>60&&(n=!0),n?e.userId===o?i.a.createElement("div",{key:t,className:a.a.dynamic([["2497068770",["style-917444","style-917444",f.a.wind]]])},i.a.createElement(p,{ctime:e.createTime}),i.a.createElement(S,e)):i.a.createElement("div",{key:t,className:a.a.dynamic([["2497068770",["style-917444","style-917444",f.a.wind]]])},i.a.createElement(p,{ctime:e.createTime}),i.a.createElement(b,e)):e.userId===o?i.a.createElement(S,se({key:t},e)):i.a.createElement(b,se({key:t},e))})),i.a.createElement(L,null),r.show&&i.a.createElement(u.r,{show:r.show,current:r.current,data:r.data.slice(),onClose:n.page.hideImgView})),i.a.createElement(a.a,{styleId:"2497068770",css:".style-917444{min-height:100vh !important;padding-bottom:0 !important;}.".concat("style-917444","__container{position:absolute;top:0;right:0;bottom:0;left:0;}.").concat("style-917444","__wrap{width:100%;padding:0.8rem ").concat(f.a.wind," 1.6rem;overflow:scroll;}"),dynamic:["style-917444","style-917444",f.a.wind]}))};ce.contextTypes={$:c.a.object};var le=Object(l.c)(ie)(Object(l.d)(ce));t.default=le}},[[821,1,0]]]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{51:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=p(a(16)),r=p(a(21)),i=p(a(18)),o=p(a(19)),c=p(a(17)),l=p(a(20)),s=p(a(8)),u=p(a(1));function p(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return(0,i.default)(this,t),(0,c.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"componentWillReceiveProps",value:function(){this.noAppearTransition=!0}},{key:"componentDidMount",value:function(){var e=this;this.props.appearTransition&&setTimeout(function(){e.barRef&&(e.barRef.style.width=e.props.percent+"%")},10)}},{key:"render",value:function(){var e,t=this,a=this.props,i=a.className,o=a.prefixCls,c=a.position,l=a.unfilled,p=a.style,d=void 0===p?{}:p,f=a.barStyle,m=void 0===f?{}:f,y={width:this.noAppearTransition||!this.props.appearTransition?this.props.percent+"%":0,height:0},b=(0,s.default)(o+"-outer",i,(e={},(0,r.default)(e,o+"-fixed-outer","fixed"===c),(0,r.default)(e,o+"-hide-outer",!l),e));return u.default.createElement("div",{style:d,className:b,role:"progressbar","aria-valuenow":this.props.percent,"aria-valuemin":0,"aria-valuemax":100},u.default.createElement("div",{ref:function(e){return t.barRef=e},className:o+"-bar",style:(0,n.default)({},m,y)}))}}]),t}(u.default.Component);t.default=d,d.defaultProps={prefixCls:"am-progress",percent:0,position:"fixed",unfilled:!0,appearTransition:!1},e.exports=t.default},831:function(e,t,a){__NEXT_REGISTER_PAGE("/discovery/post",function(){return e.exports=a(960),{page:e.exports.default}})},960:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),i=a(5),o=a(10),c=a(7),l=a(6),s=a.n(l),u=a(3),p=a(4),d=function(e,t){var a=t.$;return r.a.createElement(u.o,{show:!0,hd:r.a.createElement(u.p,{className:"t-34 t-b",type:"cross",onClick:p.a.router.back}),bd:"动态",ft:r.a.createElement("span",{className:"t-34 l-48 t-primary",onClick:a.do.publish},"发布")})};d.contextTypes={$:s.a.object};var f=Object(i.d)(d),m=a(2),y=a.n(m),b=a(8),g=a.n(b),h=function(e,t){var a=t.$,n=e.className,i=a.getState("_textarea");return r.a.createElement("div",{className:"jsx-2059990107 "+(g()("style-198939",n)||"")},r.a.createElement(u.E,{placeholder:"说点什么吧...",autoHeight:!0,clear:!0,rows:4,count:200,value:i,onChange:function(e){return a.setState(e,"_textarea")}}),r.a.createElement(y.a,{styleId:"2059990107",css:".style-198939.jsx-2059990107{padding:0.16rem;}"}))};h.contextTypes={$:s.a.object};var v=Object(i.d)(h),_=a(0),w=function(e,t){var a=t.$,n=e.index,i=e.targetPath,o=e.name,c=e.fileId,l=e.className;return r.a.createElement("div",{style:{backgroundImage:"url(".concat(p.a.getAppImgUrl(c||"".concat(i,"/").concat(o)),")")},className:y.a.dynamic([["2901793509",[_.a._bg,_.a.border,_.a.radius_sm,"style-172892"]]])+" "+(g()("style-172892",l)||"")},r.a.createElement(u.p,{className:"".concat("style-172892","__clear t-24 t-void"),type:"cross",onClick:function(){return a.page.delete(n)}}),r.a.createElement(y.a,{styleId:"2901793509",css:".style-172892{display:inline-block;vertical-align:top;position:relative;width:1.96rem;height:1.96rem;margin:0 0.24rem 0.24rem 0;".concat(_.a._bg,";border:").concat(_.a.border,";border-radius:").concat(_.a.radius_sm,";overflow:hidden;}.").concat("style-172892","__clear{position:absolute;top:0.08rem;right:0.08rem;padding:0.08rem;background:rgba(0,0,0,0.48);border-radius:50%;}"),dynamic:[_.a._bg,_.a.border,_.a.radius_sm,"style-172892"]}))};w.contextTypes={$:s.a.object};var S=Object(i.d)(w),E=function(e,t){var a=t.$,n=e.targetPath,i=e.surface,o=e.size,c=e.className;return r.a.createElement("div",{className:g()("style-172892",c)},r.a.createElement(u.G,{src:n,poster:p.a.getImgUrl(i),fileSize:o,playSecond:e.play_time,placeholderPublish:!0}),r.a.createElement(u.c,{className:"mt-md",type:"primary",ghost:!0,onClick:a.page.delete},"删除视频"))};E.contextTypes={$:s.a.object};var x,j,k,O=Object(i.d)(E),P=a(14),N=a.n(P),z=a(111),T=a.n(z),I=a(9),$=a.n(I);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t,a,n,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void a(e)}c.done?t(l):Promise.resolve(l).then(n,r)}function U(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){q(i,n,r,o,c,"next",e)}function c(e){q(i,n,r,o,c,"throw",e)}o(void 0)})}}function A(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var K="".concat("style-159399","__upload-image"),B="".concat("style-159399","__upload-video"),V=Object(i.d)((k=j=function(e){function t(){var e,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=M(this,(e=R(t)).call.apply(e,[this].concat(r)))).onUploadClick=function(){var e=a.context.$.getState("_media").type;e?"image"===e&&document.querySelector(".".concat(K," > input")).click():p.a.actionSheet(["照片","视频"],function(e){0===e?document.querySelector(".".concat(K," > input")).click():1===e&&a.uploadVideo()},{destructiveButtonIndex:void 0})},a.uploadVideo=U($.a.mark(function e(){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.context.$.fetch.qiniuKey(),document.querySelector(".".concat(B," > input")).click();case 3:case"end":return e.stop()}},e,this)})),a.beforeUploadImage=function(e){var t=a.context.$,n=t.getState("_media"),r=n.files,i=n.type;e.size/1024/1024>10?p.a.light("图片不能超过10M"):"image"===i&&r.length>=9?p.a.light("图片最多只能上传9个"):t.setState({type:"image"},"_media")},a.beforeUploadVideo=function(e){var t=a.context.$,n=t.getState("_media"),r=n.files,i=n.type;e.size/1024/1024>50?p.a.light("视频不能超过50M"):"video"===i&&r.length>=1?p.a.light("视频最多只能上传1个"):t.setState({type:"video"},"_media")},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,r.a.Component),a=t,(n=[{key:"render",value:function(){var e=this.context.$,t=e.getState("_media"),a=t.files,n=t.type,i=t.uploading,o=e.getState("qiniuFileKey"),c=this.props.className;return"video"===n&&a.length>=1||"image"===n&&a.length>=9?null:r.a.createElement("div",{className:y.a.dynamic([["4188817344",["style-159399",_.a.radius_sm]]])+" "+(g()("style-159399",c)||"")},r.a.createElement(N.a,{className:"".concat("style-159399","__item"),justify:"center",onClick:i?void 0:this.onUploadClick},i?r.a.createElement(T.a,{size:"large"}):r.a.createElement(u.p,{className:"t-48",type:"plus"})),r.a.createElement(u.F,{className:"".concat("style-159399","__upload-image"),disabled:i,beforeUpload:this.beforeUploadImage,style:{display:"none"},onProgress:e.page.uploadProgress,onSuccess:e.page.imageUploadSuccess,onError:e.page.uploadError}),r.a.createElement(u.F,{className:"".concat("style-159399","__upload-video"),qiniu:!0,qiniuFileKey:o,accept:"video/mp4,video/quicktime,video/*",disabled:i,beforeUpload:this.beforeUploadVideo,style:{display:"none"},onProgress:e.page.uploadProgress,onSuccess:e.page.videoUploadSuccess}),r.a.createElement(y.a,{styleId:"4188817344",css:".style-159399{display:inline-block;vertical-align:top;width:1.96rem;height:1.96rem;overflow:hidden;}.".concat("style-159399","__item{vertical-align:top;width:1.96rem;height:1.96rem;margin:0 0.24rem 0.24rem 0;border:0.02rem dashed #9b9b9b;border-radius:").concat(_.a.radius_sm,";}"),dynamic:["style-159399",_.a.radius_sm]}))}}])&&A(a.prototype,n),i&&A(a,i),t}(),j.contextTypes={$:s.a.object},x=k))||x,G=a(51),J=a.n(G),D=function(e,t){var a=t.$,n=e.className,i=a.getState("_media"),o=i.percent,c=i.size;return o?r.a.createElement("div",{className:g()("style-198939",n)},r.a.createElement(J.a,{percent:o,position:"normal"}),r.a.createElement("p",{className:"t-28 t-sub t-c mt-16"},r.a.createElement("span",null,"正在上传..."),r.a.createElement("span",{className:"ml-xs"},o,"%"),r.a.createElement("span",{className:"ml-xs"},"(",p.a.getMB(c*(o/100)),"MB/",p.a.getMB(c),"MB)"))):null};D.contextTypes={$:s.a.object};var H=Object(i.d)(D);function L(){return(L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var W=function(e,t){var a=t.$,n=e.className,i=a.getState("_media"),o=i.type,c=i.files;return r.a.createElement("div",{className:y.a.dynamic([["2613692757",[_.a.wind]]])+" "+(g()("style-525702",n)||"")},"image"===o&&c.map(function(e,t){return r.a.createElement(S,L({key:"".concat(e.targetPath,"/").concat(e.name),index:t},e))}),"video"===o&&c.map(function(e){return r.a.createElement(O,L({key:e.name},e))}),r.a.createElement(V,null),r.a.createElement(H,{className:"mt-md"}),r.a.createElement(y.a,{styleId:"2613692757",css:".style-525702.__jsx-style-dynamic-selector{padding:0 ".concat(_.a.wind,";}"),dynamic:[_.a.wind]}))};W.contextTypes={$:s.a.object};var X,Q,Y=Object(i.d)(W),Z=a(11),ee=a(12),te=a(15),ae={video:1,image:2,article:3};function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ie(e,t,a,n,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void a(e)}c.done?t(l):Promise.resolve(l).then(n,r)}function oe(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var i=e.apply(t,a);function o(e){ie(i,n,r,o,c,"next",e)}function c(e){ie(i,n,r,o,c,"throw",e)}o(void 0)})}}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ue,pe,de,fe,me,ye,be=(X=function(e){function t(){var e,a,n,r,i,o,c,l,s,u,d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var f=arguments.length,m=new Array(f),y=0;y<f;y++)m[y]=arguments[y];return n=this,r=(e=ce(t)).call.apply(e,[this].concat(m)),a=!r||"object"!==ne(r)&&"function"!=typeof r?se(n):r,i=a,o="state",c=Q,l=se(se(a)),c&&Object.defineProperty(i,o,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(l):void 0}),a.fetch={config:{},qiniuKey:(s=oe($.a.mark(function e(){var t,n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=te.a.P("get_qiniu_key"),e.next=3,t;case 3:return n=e.sent,a.setState({qiniuFileKey:n}),e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},a.do={publish:(u=oe($.a.mark(function e(){var t,n,r,i,o,c,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.getState("_media"),n=t.files,r=t.type,i=a.getState("_textarea"),n.length||!(i.replace(/\s/g,"").length<30)){e.next=5;break}return p.a.light("纯文不能少于30个字"),e.abrupt("return");case 5:if(!(i.replace(/\s/g,"").length<20)){e.next=8;break}return p.a.light("图文不能少于20个字"),e.abrupt("return");case 8:return o={con:i,infoType:ae[r],fileIds:n.map(function(e){return e.fileId}).join(",")},e.next=11,te.a.P("do_publish",o);case 11:c=e.sent,l=c.point,a.page.reset(),p.a.light("发布成功，积分+".concat(l)),window.Stores["/discovery"]&&window.Stores["/discovery"].setRefresh(),p.a.router.back();case 17:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},a.page={uploadProgress:function(e,t){var n=Math.round(e.percent);a.setState({uploading:!0,percent:n,size:t.size},"_media")},imageUploadSuccess:function(e){var t=re(a.getState("_media").files);t.push(e.data),a.setState({files:t,type:"image",percent:0,size:0,uploading:!1},"_media")},videoUploadSuccess:(d=oe($.a.mark(function e(t){var n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("success"===t.ret){e.next=4;break}return a.setState({files:[],type:"video",percent:0,size:0,uploading:!1}),p.a.light("视频上传失败，请重试。"),e.abrupt("return");case 4:return n=a.getState("qiniuFileKey"),e.next=7,te.a.P("get_qiniu_file-info",{key:n});case 7:r=e.sent,a.setState({files:[{fileId:n,name:r.hash,play_time:r.playTime,size:r.fsize,surface:r.surImg,targetPath:r.filePath,type:"mp4"}],type:"video",percent:0,size:0,uploading:!1},"_media");case 9:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)}),uploadError:function(){a.setState({uploading:!1},"_media")},delete:function(e){var t=re(a.getState("_media").files);t.splice(e,1),0===t.length?a.setState({files:[],type:void 0},"_media"):a.setState({files:t},"_media")},reset:function(){a.setState({files:[],type:void 0,uploading:!1,percent:0,size:0},"_media"),a.setState("","_textarea")}},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(t,ee["a"]),t}(),ue=X.prototype,pe="state",de=[Z.k],fe={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.initState({_media:{files:[],type:void 0,uploading:!1,percent:0,size:0},_textarea:"",qiniuFileKey:""})}},ye={},Object.keys(fe).forEach(function(e){ye[e]=fe[e]}),ye.enumerable=!!ye.enumerable,ye.configurable=!!ye.configurable,("value"in ye||ye.initializer)&&(ye.writable=!0),ye=de.slice().reverse().reduce(function(e,t){return t(ue,pe,e)||e},ye),me&&void 0!==ye.initializer&&(ye.value=ye.initializer?ye.initializer.call(me):void 0,ye.initializer=void 0),void 0===ye.initializer&&(Object.defineProperty(ue,pe,ye),ye=null),Q=ye,X),ge=Object(i.c)(be)(function(){return c.a.__CLIENT__&&r.a.createElement(o.k,{title:"动态",theme:"fullTheme",header:r.a.createElement(f,null)},r.a.createElement(v,null),r.a.createElement(Y,{className:"mt-24"}))});t.default=ge}},[[831,1,0]]]);